<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!--
  Created using JS Bin
  http://jsbin.com

  Copyright (c) 2019 by jakearchibald (http://jsbin.com/surane/7/edit)

  Released under the MIT license: http://jsbin.mit-license.org
  -->
  <meta name="robots" content="noindex">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
  <title>JS Bin</title>

  <style id="jsbin-css">
    .container div {
      display: inline-block;
      margin: 7px;
      width: 45px;
      height: 45px;
      background: red linear-gradient(to bottom, orange, transparent);
    }


  </style>
</head>
<body>
<div class="container">

</div>
<script>
  var container = document.querySelector('.container');
  container.innerHTML = Array(500).join('<div></div>');
  var els = Array.prototype.slice.call(document.querySelectorAll('.container div'));
  var start = performance.now();
  let prev = start;
  let frames = 0;
  function loop(now) {
    if((now - prev) >= 1e3) {
      console.log(`${frames} fps`);
      document.title = `${frames} fps`;
      prev = now;
      frames = 0;
    }

    ++frames;

    els.forEach(function(el, i) {
      const dur = (now - start) + (i*50);
      const pos = (dur % 3000) / 3000;
      const bouncePos = Math.abs(pos * 2 - 1);
      const r = bouncePos * 50 + 50;
      const b = (1 - bouncePos) * 50;

      const rotation = pos * 360;
      const radius = bouncePos * 25;

      el.style.transform = 'rotate(' + rotation + 'deg)';
      el.style.borderRadius = radius + 'px';
      el.style.backgroundColor = 'rgb(' + r + '%, 0%, ' + b + '%)';
    });

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
</script>
</body>
</html>
